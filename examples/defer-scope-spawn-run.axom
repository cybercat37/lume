print "defer demo start"

scope {
  defer {
    print "defer: scope cleanup"
  }

  let fast = spawn {
    sleep(40)
    print "fast task done"
    1
  }

  let slow = spawn {
    sleep(120)
    print "slow task done"
    2
  }

  print "waiting joins"
  print fast.join()
  print slow.join()
  print "about to exit scope"
}

print "after scope"
